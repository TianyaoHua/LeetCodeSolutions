class Solution(object):
    def cal(self, s, n):
        p = -1
        a = 0
        i = 0
        s += '+'
        operation = 1
        while i < n:
            if s[i] != '+' and s[i] != '-':
                if p < 0:
                    p = i
            else:
                if operation == 1:
                    a += int(s[p: i])
                else:
                    a -= int(s[p: i])
                if s[i] == '+':
                    operation = 1
                else:
                    operation = 0
                p = -1
            i += 1
        return a

    def calculate(self, s):
        """
        :type s: str
        :rtype: int
        """
        s = s.replace(' ','')
        p = []
        i = 0
        n = len(s)
        while i < n:
            if s[i] == '(':
                p.append(i)
            if s[i] == ')':
                front = p.pop()
                a = (self.cal(s[front+1: i], i-front)) #length is increaded by 1
                a_s = str(a)
                if a < 0:
                    if front > 0:
                        if s[front-1] == '+':
                            s = s[:front-1] + a_s + s[i + 1:]
                        else:
                            s = s[:front-1] + '+' + a_s[1:] + s[i+1:]
                        n += (len(a_s) - (i+1-front)) - 1
                        i += (len(a_s) - (i+1-front)) - 1
                    else:
                        return a_s
                else:
                    s = s[:front] + a_s + s[i+1:]
                    n += (len(a_s) - (i+1-front))
                    i += (len(a_s) - (i+1-front))
            i += 1
        return self.cal(s, n+1) # +1
#s = (9568+(9040-(380+(2042-(7115)+(6294)-(4395-(5183+9744+(7746-(1099+2718))-(9370-(8561+(9302)-(7632+(8451-(1759+(7760))-(3377+5363+9093+(8332-(4492-(1151+(1165-8833+(775+(3749)+9399))+9112+(6273+(7285-(6112-(668-(7756-4316-(582+1835-(6644+690+1204-(7197+(7897))+(7009-(7262))-7782-(7858+(7644+(9461+(2224)-(7531-1095-(891+1022)+2197-(9855)))+(6663-(7417-(6158-(3610))+(1481))-(4182+(4761)))+(5017))+(9990)+(6218)))-(2904)+(5631)-(8888)+3401+(3569))+(1135))-(3695-(7713+(3479)-(9813+(8171+(8616-8026+(4634-(6973))-(9761-(623-4782)+(2514)+(6233)))))+(6140))-(6641)-8611+(8389)+8074-(4412))-(3703)+(9688+(9513))))-(4987)))+(9647)))))))))-(2299))-(4785))))))

solution = Solution()
s = "(9568+(9040-(380+(2042-(7115)+(6294)-(4395-(5183+9744+(7746-(1099+2718))-(9370-(8561+(9302)-(7632+(8451-(1759+(7760))-(3377+5363+9093+(8332-(4492-(1151+(1165-8833+(775+(3749)+9399))+9112+(6273+(7285-(6112-(668-(7756-4316-(582+1835-(6644+690+1204-(7197+(7897))+(7009-(7262))-7782-(7858+(7644+(9461+(2224)-(7531-1095-(891+1022)+2197-(9855)))+(6663-(7417-(6158-(3610))+(1481))-(4182+(4761)))+(5017))+(9990)+(6218)))-(2904)+(5631)-(8888)+3401+(3569))+(1135))-(3695-(7713+(3479)-(9813+(8171+(8616-8026+(4634-(6973))-(9761-(623-4782)+(2514)+(6233)))))+(6140))-(6641)-8611+(8389)+8074-(4412))-(3703)+(9688+(9513))))-(4987)))+(9647)))))))))-(2299))-(4785))))))"
print(solution.calculate(s))

